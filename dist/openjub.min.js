/*! openjub-js-sdk - v0.0.1 - 2015-03-08 */
"use strict";!function(a,b){var c={};c.utils={},c.utils.makeFunction=function(a){return"function"==typeof a?a:function(){return a}},c.utils.setCookie=function(a,c){if(b){var d=new Date;d.setTime(d.getTime()+864e5);var e="expires="+d.toUTCString();return document.cookie=a+"="+c+"; "+e,c}return void 0},c.utils.deleteCookie=function(a){return b?void(document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"):void 0},c.utils.getCookie=function(a){if(b){a+="=";for(var c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(0==e.indexOf(a))return e.substring(a.length,e.length)}return void 0}return void 0},c.requests={},c.requests.get=function(a,d,e){return b?c.requests.browser.get(a,d,e):c.requests.node.get(a,d,e)},c.requests.post=function(a,d,e,f){return b?c.requests.browser.post(a,d,e,f):c.requests.node.post(a,d,e,f)},c.requests.joinURL=function(a,b){var c="http://",d="https://";return a.substring(0,d.length)!==d&&a.substring(0,c.length)!==c&&(a=d+a),"/"===a[a.length-1]&&(a=a.substring(0,a.length-1)),"/"!==b[0]&&(b="/"+b),a+b},c.requests.buildGETUrl=function(a,b){var d=c.requests.extractGetParams(a);a=a.split("?")[0];var e="";for(var f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);for(var f in d)b.hasOwnProperty(f)&&"undefined"!=typeof b[f]&&(e+=encodeURIComponent(f)+"="+encodeURIComponent(b[f])+"&");return""!==e&&(e="?"+e.substring(0,e.length-1)),a+e},c.requests.extractGetParams=function(a){var b={};if(-1!==a.indexOf("?")){var c=a.split("?");c.shift(),c=c.join("?"),c=c.split("&");for(var d=0;d<c.length;d++){var e=c[d].split("="),f=unescape(e.shift()),g=unescape(e.join("="));b.hasOwnProperty(f)||(b[f]=g)}}return b},c.requests.browser={},c.requests.browser.get=function(a,b,d){a=c.requests.buildGETUrl(a,b),jQuery.ajax(a,{dataType:"json"}).always(function(a,b,c){"success"!==b&&(c=a),d(c.status,c.responseJSON)})},c.requests.browser.post=function(a,b,d,e){a=c.requests.buildGETUrl(a,b),jQuery.ajax(a,{type:"POST",data:d,dataType:"json"}).always(function(a,b,c){"success"!==b&&(c=a),e(c.status,c.responseJSON)})},c.requests.node={},c.requests.node.get=function(){},c.requests.node.post=function(){},c.Client=function(a,b){b=c.utils.makeFunction(b),this.server=a,this.token=c.utils.getCookie("JUB_token"),this.user=void 0,this.status(function(){b()})},c.test=function(a,b){console.log("error",a,"data",b)},c.Client.prototype.signin=function(a,b,d){var e=this;d=c.utils.makeFunction(d),c.requests.post(c.requests.joinURL(this.server,"/auth/signin"),{},{username:a,password:b},function(a,b){200===a?(e.token=b.token,c.utils.setCookie("JUB_token",e.token),d(void 0,b)):d(b.error)})},c.Client.prototype.signout=function(a){var b=this;a=c.utils.makeFunction(a),c.requests.get(c.requests.joinURL(this.server,"/auth/signout"),{token:this.token},function(d,e){200===d?(b.token=void 0,b.user=void 0,c.utils.deleteCookie("JUB_token"),a(void 0,e)):a(e.error)})},c.Client.prototype.status=function(a){var b=this;a=c.utils.makeFunction(a),c.requests.get(c.requests.joinURL(this.server,"/auth/status"),{token:this.token},function(d,e){if(200===d){if(!e.user)return b.token=void 0,b.user=void 0,c.utils.deleteCookie("JUB_token"),void a(void 0,e);e.token&&(b.token=e.token,b.user=e.user,c.utils.setCookie("JUB_token",b.token)),a(void 0,e)}else a(e.error)})},c.Client.prototype.isOnCampus=function(a){a=c.utils.makeFunction(a),c.requests.get(c.requests.joinURL(this.server,"/auth/isoncampus"),{},function(b,c){200===b?a(void 0,c):a(c.error)})},c.Client.prototype.authenticate=function(a){if(b){var d=this,e=function(b){if(b.origin===d.server){window.removeEventListener(e);var c=("string"==typeof b.data?JSON.parse(b.data):b.data).token;d.token=c,d.status(a)}};window.addEventListener("message",e),window.open(c.requests.joinURL(this.server,"/view/login"),"_blank","width=500, height=400, resizeable=no, toolbar=no, scrollbar=no, location=no")}},c.Client.prototype.getMe=function(a,b){var d=this;b=c.utils.makeFunction(b),a&&0==a.length&&(a=void 0),c.requests.get(c.requests.joinURL(this.server,"/user/me"),{token:this.token,fields:a},function(a,c){200===a?b(void 0,c):d.status(function(){b(c.error)})})},c.Client.prototype.amIAGoat=function(a){var b=this;a=c.utils.makeFunction(a),c.requests.get(c.requests.joinURL(this.server,"/user/me/isagoat"),{},function(c,d){200===c?a(void 0,d):b.status(function(){a(d.error)})})},c.Client.prototype.getUserById=function(a,b,d){var e=this;b&&0==b.length&&(b=void 0),c.requests.get(c.requests.joinURL(this.server,"/user/id/"+a),{token:this.token,fields:b},function(a,b){200===a?d(void 0,b):e.status(function(){d(b.error)})})},c.Client.prototype.getUserByName=function(a,b,d){var e=this;b&&0==b.length&&(b=void 0),c.requests.get(c.requests.joinURL(this.server,"/user/name/"+a),{token:this.token,fields:b},function(a,b){200===a?d(void 0,b):e.status(function(){d(b.error)})})},c.Client.prototype.query=function(a,b,d,e,f){var g=this;"function"==typeof d&&(f=d,d=void 0,e=void 0),f=c.utils.makeFunction(f),b&&0==b.length&&(b=void 0),c.requests.get(c.requests.joinURL(this.server,"query/"+escape(a)),{fields:b,limit:d,skip:e,token:this.token},function(b,d){200===b?f(void 0,new c.queryResult(d,a,g)):g.status(function(){f(d.error)})})},c.queryResult=function(a,b,c){this.client=c,this.query=b,this._data=a,this.data=a.data},c.queryResult.prototype.next=function(a){var b=c.requests.extractGetParams(this._data.next);return b.fields=b.fields?b.fields.split(","):void 0,b.limit=parseInt(b.limit)||void 0,b.skip=parseInt(b.skip)||void 0,this.query(this.query,b.fields,b.limit,b.skip,a)},c.queryResult.prototype.prev=function(a){var b=c.requests.extractGetParams(this._data.prev);return b.fields=b.fields?b.fields.split(","):void 0,b.limit=parseInt(b.limit)||void 0,b.skip=parseInt(b.skip)||void 0,this.query(this.query,b.fields,b.limit,b.skip,a)},c.Client.prototype.search=function(a,b,d,e,f){var g=this;"function"==typeof d&&(f=d,d=void 0,e=void 0),f=c.utils.makeFunction(f),b&&0==b.length&&(b=void 0),c.requests.get(c.requests.joinURL(this.server,"search/"+escape(a)),{fields:b,limit:d,skip:e,token:this.token},function(b,d){200===b?f(void 0,new c.searchResult(d,a,g)):g.status(function(){f(d.error)})})},c.searchResult=function(a,b,c){this.client=c,this.search=b,this._data=a,this.data=a.data},c.searchResult.prototype.next=function(a){var b=c.requests.extractGetParams(this._data.next);return b.fields=b.fields?b.fields.split(","):void 0,b.limit=parseInt(b.limit)||void 0,b.skip=parseInt(b.skip)||void 0,this.search(this.search,b.fields,b.limit,b.skip,a)},c.searchResult.prototype.prev=function(a){var b=c.requests.extractGetParams(this._data.prev);return b.fields=b.fields?b.fields.split(","):void 0,b.limit=parseInt(b.limit)||void 0,b.skip=parseInt(b.skip)||void 0,this.search(this.search,b.fields,b.limit,b.skip,a)},a.JUB=c}("undefined"==typeof exports?window:exports,"undefined"==typeof exports);